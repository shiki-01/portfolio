<script lang="ts">
  import { onMount } from "svelte";
  import gsap from "gsap";
  import { DrawSVGPlugin } from "gsap/DrawSVGPlugin";

  gsap.registerPlugin(DrawSVGPlugin);

  let pathMain: SVGPathElement;
  let pathSub1: SVGPathElement;
  let pathSub2: SVGPathElement;

  let maskPath: SVGPathElement; // マスク用（赤い太線と同じ形）

  onMount(() => {
    // マスク用パスを最初は非表示（0%）
    gsap.set(maskPath, { drawSVG: "100% 100%" });

    const tl = gsap.timeline({ defaults: { ease: "power2.out" } });

    // 既存の黒い線アニメーション（例）
    tl.to(pathMain, {
      duration: 2,
      drawSVG: "0% 100%"
    });

    tl.to(pathSub1, {
      duration: 0.7,
      drawSVG: "0% 100%"
    });

    tl.to(
      pathSub2,
      {
        duration: 0.7,
        drawSVG: "0% 100%"
      },
      "<"
    );

    // マスク側のパスを終端→始端に向かって伸ばしていく
    tl.to(maskPath, {
      duration: 2,
      drawSVG: "0% 100%"
    });
  });
</script>

<svg
  width="312"
  height="400"
  viewBox="0 0 312 400"
  fill="none"
  xmlns="http://www.w3.org/2000/svg"
>
  <defs>
    <!-- 赤い太線と同じパスをマスクとして使う -->
    <mask id="revealMask" maskUnits="userSpaceOnUse">
      <!-- 背景を黒にして、白い部分だけ表示されるようにする -->
      <rect x="0" y="0" width="312" height="400" fill="black" />
      <path
        bind:this={maskPath}
        d="M245.871 92.6554L161.799 67.3308C125.085 56.2717 86.7605 78.9533 78.7885 116.459C71.6554 150.017 91.61 183.398 124.546 193.003L186.344 211.026C219.513 220.699 239.399 254.543 231.707 288.226C223.29 325.085 185.416 347.107 149.219 336.19L64.517 310.644"
        stroke="white"
        stroke-width="129"
        stroke-linecap="round"
        fill="none"
      />
    </mask>
  </defs>

  <!-- 既存のラインアニメーション用パス -->
  <path
    bind:this={pathMain}
    d="M22.3359 102.146C37.6273 30.2078 111.125 -13.3104 181.554 7.87402L265.763 33.2051C297.63 42.7909 315.694 76.3965 306.108 108.264C296.522 140.13 262.919 158.192 231.052 148.607L146.841 123.278L146.84 123.277C143.909 122.397 140.849 124.208 140.212 127.202V127.203C139.659 129.806 141.147 132.393 143.64 133.244L143.884 133.321L204.835 150.876H204.836C268.245 169.138 306.752 233.31 293.033 297.854C277.742 369.793 204.243 413.311 133.814 392.126L114.634 386.355L113.146 385.908L112.087 387.043C104.999 394.629 93.7987 397.651 83.459 393.832C74.211 390.416 67.9961 382.397 66.46 373.316L66.2002 371.786L64.7148 371.339L49.6064 366.795C49.4972 366.762 49.4927 366.759 49.334 366.711L47.9736 366.295L46.9209 367.252C37.829 375.518 23.8944 376.596 13.5312 369.124C1.81629 360.678 -0.974976 344.455 7.125 332.599L7.51855 332.037L9.21777 329.68L9.95605 328.656L9.57031 327.454C5.9724 316.243 5.61107 303.869 9.25977 291.738C12.753 280.125 19.4339 270.352 28.0557 263.077L28.4268 262.765L28.6533 262.336L47.6748 226.375C50.7165 220.626 58.9638 220.654 61.9668 226.424L73.2256 248.062L73.8223 249.208L75.1025 249.384C78.1738 249.807 81.2539 250.473 84.3184 251.395H84.3193L102.992 257.009L104.342 257.415L105.388 256.471L124.299 239.387C129.126 235.026 136.866 237.877 137.711 244.326L140.651 266.796L140.86 268.4L142.409 268.866L168.528 276.724C171.46 277.605 174.519 275.794 175.156 272.8V272.799C175.727 270.112 174.125 267.44 171.485 266.68H171.484L150.205 260.549L147.906 242.992C145.985 228.322 128.385 221.839 117.406 231.756L101.478 246.141C92.512 242.813 84.117 238.539 76.376 233.466C75.7658 231.702 74.9611 229.628 73.9004 227.249L73.3506 226.038C72.9761 225.228 72.2854 223.422 70.8838 221.317C67.3105 215.953 62.1445 212.3 56.1475 211.846L55.5645 211.812L51.166 211.631C25.5937 182.694 13.7598 142.494 22.3359 102.146Z"
    stroke="black"
    stroke-width="5"
    stroke-linecap="round"
    fill="none"
  />

  <path
    bind:this={pathSub1}
    d="M88.64 303.65L88.8697 303.837C95.9728 309.633 105.712 310.991 114.13 307.36"
    stroke="black"
    stroke-width="5"
    stroke-linecap="round"
    fill="none"
  />
  <path
    bind:this={pathSub2}
    d="M32.4285 295.508L32.6581 295.696C39.7612 301.492 49.5006 302.85 57.9184 299.218"
    stroke="black"
    stroke-width="5"
    stroke-linecap="round"
    fill="none"
  />

  <!-- 黒いアイコンをマスクの中に入れる -->
  <g mask="url(#revealMask)">
    <path
      d="M19.8904 101.626C35.4861 28.2571 110.445 -16.1256 182.274 5.48035L266.482 30.8104C299.672 40.7938 318.485 75.7928 308.502 108.982C298.518 142.172 263.519 160.984 230.33 151.001L146.12 125.672C144.588 125.211 142.99 126.157 142.657 127.722C142.359 129.126 143.197 130.522 144.576 130.919L205.526 148.474C270.197 167.099 309.47 232.545 295.478 298.374C279.883 371.743 204.924 416.126 133.094 394.52L113.913 388.749C106.162 397.045 93.909 400.358 82.5915 396.178C72.47 392.439 65.6732 383.66 63.9939 373.733L48.8855 369.189C48.7908 369.161 48.6968 369.13 48.6023 369.101C38.6545 378.146 23.4106 379.328 12.0691 371.151C-0.951846 361.763 -3.89684 343.596 5.49096 330.575L7.1892 328.218C3.44172 316.541 3.06653 303.649 6.86596 291.017C10.5031 278.926 17.4625 268.745 26.4431 261.167L45.4646 225.207C49.4485 217.675 60.2511 217.711 64.1843 225.269L75.4431 246.907C78.642 247.347 81.8485 248.04 85.0378 248.999L103.712 254.614L122.623 237.531C128.946 231.82 139.083 235.554 140.189 244.002L143.129 266.472L169.248 274.329C170.779 274.789 172.378 273.843 172.711 272.279C173.009 270.875 172.171 269.478 170.792 269.081L147.938 262.499L145.427 243.316C143.768 230.644 128.566 225.045 119.082 233.61L102.034 249.007C92.0733 245.443 82.7859 240.74 74.2839 235.085C73.5862 232.97 72.5668 230.3 71.0808 227.088C70.6406 226.136 70.0644 224.597 68.8025 222.703C65.4356 217.649 60.7105 214.522 55.4617 214.308L50.0007 214.086C23.433 184.522 11.0642 143.15 19.8904 101.626ZM90.2204 301.713C89.1507 300.84 87.5757 301.001 86.7029 302.07C85.8303 303.14 85.99 304.714 87.0593 305.587L87.2888 305.774C95.1147 312.16 105.846 313.657 115.12 309.656C116.387 309.109 116.971 307.638 116.425 306.37C115.877 305.103 114.407 304.518 113.139 305.064C105.578 308.326 96.8301 307.106 90.4499 301.9L90.2204 301.713ZM34.0085 293.571C32.9388 292.699 31.3647 292.859 30.4919 293.929C29.6194 294.998 29.7782 296.572 30.8474 297.445L31.0769 297.633C38.9027 304.018 49.6336 305.515 58.9079 301.515C60.1756 300.968 60.7602 299.496 60.2136 298.228C59.6665 296.961 58.195 296.376 56.9275 296.923C49.3666 300.184 40.6191 298.964 34.239 293.759L34.0085 293.571Z"
      fill="black"
    />
  </g>
</svg>
